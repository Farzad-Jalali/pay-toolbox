{% extends "layout/layout.njk" %}

{% block main %}
  {# <span class="govuk-caption-m">Payment</span> #}
  {# <h1 class="govuk-heading-m">{{ transaction.reference }}</h1> #}
  <h1 class="govuk-heading-m">Payment</h1>

  <div class="status-inline-spacer">
  <span class="govuk-body-l status-amount">{{ transaction.amount | currency }}</span>
  <strong class="govuk-tag status-tag">Succeeded</strong>
  </div>

  <div class="govuk-grid-row status-spacer">
    <div class="govuk-grid-column-one-quarter border-right">
      <span class="govuk-caption-m">Date</span>
      <span class="govuk-body">{{ transaction.created_date | formatDate }}</span>
    </div>
    <div class="govuk-grid-column-one-quarter border-right">
      <span class="govuk-caption-m">Payee</span>
      <span class="govuk-body">{{ transaction.card_details.cardholder_name }}</span>
    </div>
    <div class="govuk-grid-column-one-quarter">
      <span class="govuk-caption-m">Payment method</span>
      <span class="govuk-body">{{ transaction.card_details.card_brand }} <strong>••••</strong> {{ transaction.card_details.last_digits_card_number }}</span>
    </div>
  </div>

  <div>
    <h1 class="govuk-heading-s payment__header">Payment details</h1>
    <table class="govuk-table">
      <tbody class="govuk-table__body">
        <tr class="govuk-table__row">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Reference</span></th>
          <td class="govuk-table__cell payment__cell">{{ transaction.reference }}</td>
        </tr>
        <tr class="govuk-table__row">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Description</span></th>
          <td class="govuk-table__cell payment__cell">{{ transaction.description }}</td>
        </tr>
        <tr class="govuk-table__row">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Amount</span></th>
          <td class="govuk-table__cell payment__cell">
            <span>{{ transaction.total_amount | currency }} </span>
            {% if transaction.corperate_surcharge %}
            <span>(including {{ transaction.corperate_surcharge | currency }}) corperate surcharge</span>
            {% endif %}
          </td>
        </tr>
        {% if transaction.fee %}
        <tr class="govuk-table__row">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Fee</span></th>
          <td class="govuk-table__cell payment__cell">{{ transaction.fee | currency }}</td>
        </tr>
        <tr class="govuk-table__row ">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Net</span></th>
          <td class="govuk-table__cell payment__cell">{{ transaction.net_amount | currency }}</td>
        </tr>
        {% endif %}
        {% if transaction.refund_summary.status %}
        <tr class="govuk-table__row">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Refunded</span></th>
          <td class="govuk-table__cell payment__cell">{{ transaction.refund_summary.amount_submitted | currency }}</td>
        </tr>
        <tr class="govuk-table__row ">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Available</span></th>
          <td class="govuk-table__cell payment__cell">{{ transaction.refund_summary.amount_available | currency }}</td>
        </tr>
        {% endif %}
    </table>
  </div>

{% if transaction.refund_summary.status %}
  <div>
    <h1 class="govuk-heading-s payment__header">Related transactions</h1>
    <table class="govuk-table">
      <tbody class="govuk-table__body">
        {% for transaction in refunds %}
        <tr class="govuk-table__row">
          <td class="govuk-table__cell payment__cell" scope="row">
            <a class="govuk-link govuk-link--no-visited-state" href="/transactions/{{refund.transaction_id}}">{{ refund.transaction_id }}
          </td>
          <td class="govuk-table__cell payment__cell">
            <th class="govuk-table__cell payment__cell text-right" scope="row">
              <span class="govuk-caption-m">{{ refund.date | formatDateLong }}</span>
            </th>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endif %}

  <div>
    <h1 class="govuk-heading-s payment__header">Processing details</h1>
    <table class="govuk-table">
      <tbody class="govuk-table__body">
        <tr class="govuk-table__row">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Gateway account</span></th>
          <td class="govuk-table__cell payment__cell">
            <a class="govuk-link govuk-link--no-visited-state" href="/gateway_accounts/{{transaction.gateway_account_id}}">{{ transaction.gateway_account_id }}
          </td>
        </tr>
        <tr class="govuk-table__row">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Service</span></th>
          <td class="govuk-table__cell payment__cell">
          <a class="govuk-link govuk-link--no-visited-state" href="/services/{{service.external_id}}">{{ service.external_id }}
          </td>
        </tr>
        <tr class="govuk-table__row">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Payment provider</span></th>
          <td class="govuk-table__cell payment__cell">{{ transaction.payment_provider | capitalize }}</td>
        </tr>
        <tr class="govuk-table__row">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Provider transaction</span></th>
          <td class="govuk-table__cell payment__cell">{{ transaction.gateway_transaction_id }}</td>
        </tr>
        <tr class="govuk-table__row">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Delayed capture</span></th>
          <td class="govuk-table__cell payment__cell">{{ transaction.delayed_capture | string | capitalize }}</td>
        </tr>
        <tr class="govuk-table__row">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Authorise duration</span></th>
          <td class="govuk-table__cell payment__cell">20ms</td>
        </tr>
        <tr class="govuk-table__row">
          <th class="govuk-table__cell payment__cell" scope="row"><span class="govuk-caption-m">Capture duration</span></th>
          <td class="govuk-table__cell payment__cell">5s</td>
        </tr>
      </tobdy>
    </table>
  </div>

  <div>
    <h1 class="govuk-heading-s payment__header">Metadata</h1>

    {% if not transaction.metadata %}
    <div class="center bottom-spacer"><span class="govuk-caption-m">No metadata</span></div>
    {% endif %}
  </div>

  <div>
    <h1 class="govuk-heading-s payment__header">Ledger events</h1>
    <div class="center bottom-spacer"><span class="govuk-caption-m">Events not implemented</span></div>
  </div>

{% endblock %}
